<!DOCTYPE html>
<head>
    <title>gravitypong</title>

    <script src="https://cdn.jsdelivr.net/npm/p5@1.9.0/lib/p5.js"></script>
    <script type="module" src="/dist/index.js"></script>

    <script>
        let s = null;

        function initSim() {
            if (!s) {
                const Simulation = window["Simulation"];

                if (Simulation) {
                    s = Simulation.instance({ n: 1000, sun: true });
                    s.start();

                    document.addEventListener("keypress", (event) => {
                        if (event.key === " ") {
                            if (s.isPaused) {
                                s.resume();
                            } else {
                                s.pause();
                            }
                        }
                    }); 
                }
            } 
        }

        function setup() {
            frameRate(20);
            createCanvas(window.innerWidth, 1000);
        }        
        
        function draw() {
            background(200);
            const c = color(65);

            initSim();
            fill(c);

            if (s && s.bodies) {
                document.getElementById("count").textContent = s.bodyCount;
                document.getElementById("framerate").textContent = s.framerate;
                
                for (const b of s.bodies.values()) {
                    circle(
                        b.pos.x / 20 + 500, 
                        b.pos.y / 20 + 500, 
                        Math.max(2, b.r / 24));
                }
            }
        }
    </script>

    <style>
        body { 
            margin: 0; 
            font-family: "helvetica";
        }

        #wrapper {
            width: 100%;
            margin: 0;
        }

        header {
            width: 100%;
        }

        #content {
            width: 100%;
        }

        .hud {
            position: absolute;
        }
    </style>
</head>
<body>
    <div id="wrapper">

        <header>
            <h3 id="title">Sim</h3>

            <nav></nav>
        </header>

        <div id="content">
            <div class="hud">
                <div id="config" class="hud-section"></div>
                <div id="controls" class="hud-section"></div>
                <div id="telemetry" class="hud-section">

                    <ul>Count: <span data-bind-sim-property="count"></span></ul>
                    <ul>FPS:   <span id="framerate"></span></ul>
                </div>
            </div>
        
            <div id="p5sketch"></div>
        </div>
    </div>    
</body>